---
- name: Install Docker, Telegraf & Containers
  hosts: testcontainers
  gather_facts: false
  become: true

  tasks:
    - name: Docker block
      block:
        - name: Install Docker prerequisites
          apt:
            name:
              - apt-transport-https
              - ca-certificates
              - curl
              - software-properties-common
            state: present

        - name: Add Docker GPG key
          apt_key:
            url: https://download.docker.com/linux/ubuntu/gpg
            state: present

        - name: Add Docker repository
          apt_repository:
            repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
            state: present

        - name: Install Docker
          apt:
            name: docker-ce
            state: present
      #ignore_errors: true

      rescue:
        - debug:
            msg: "Failed to install Docker"

    - name: Install Telegraf
      include_tasks: components/telegraf_service.yml
